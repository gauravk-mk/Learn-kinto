!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).KintoClient=t()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};function t(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}var r=function(){return(r=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function i(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}function n(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{u(i.next(e))}catch(e){o(e)}}function a(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((i=i.apply(e,t||[])).next())}))}function o(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return s}function u(e){if(l(e))return e;if("string"==typeof e)return{id:e};throw new Error("Invalid argument.")}function c(e){var t=function(e){return encodeURIComponent("boolean"==typeof e?String(e):e)},r=v(e);return Object.keys(r).map((function(e){var i=t(e)+"=";return Array.isArray(r[e])?i+r[e].map((function(e){return t(e)})).join(","):i+t(r[e])})).join("&")}function h(e,t,r){var i=function(e){return e.split(".").map((function(e){return parseInt(e,10)}))},n=a(i(e),2),o=n[0],s=n[1],u=a(i(t),2),c=u[0],h=u[1],d=a(i(r),2),f=d[0],l=d[1];if([o<c,o===c&&s<h,o>f,o===f&&s>=l].some((function(e){return e})))throw new Error("Version "+e+" doesn't satisfy "+t+" <= x < "+r)}function d(e){return function(t,r,i){var n=i.value;return{configurable:!0,get:function(){var t=this,i=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=t.client?t.client:t;return o.fetchServerCapabilities().then((function(t){var r=e.filter((function(e){return!(e in t)}));if(r.length>0){var i=r.join(", ");throw new Error("Required capabilities "+i+" not present on server")}})).then((function(){return n.apply(t,r)}))};return Object.defineProperty(this,r,{value:i,configurable:!0,writable:!0}),i}}}}function f(e){return function(t,r,i){var n=i.value;return{configurable:!0,get:function(){var t=this,i=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(t._isBatch)throw new Error(e);return n.apply(t,r)};return Object.defineProperty(this,r,{value:i,configurable:!0,writable:!0}),i}}}}function l(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function p(e){for(var t=function(e){var t=e.match(/^data:(.*);base64,(.*)/);if(!t)throw new Error("Invalid data-url: "+String(e).substr(0,32)+"...");var i=t[1],n=t[2],o=a(i.split(";")),s=o[0],u=o.slice(1).reduce((function(e,t){var i,n=a(t.split("="),2),o=n[0],s=n[1];return r(r({},e),((i={})[o]=s,i))}),{});return r(r({},u),{type:s,base64:n})}(e),i=t.name,n=t.type,o=t.base64,s=atob(o),u=[],c=0;c<s.length;c++)u.push(s.charCodeAt(c));return{blob:new Blob([new Uint8Array(u)],{type:n}),name:i}}function v(e){var t={};for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}function y(e){var t,r,i=new Headers(e);i.has("authorization")&&i.set("authorization","**** (suppressed)");var n={};try{for(var o=s(i.entries()),u=o.next();!u.done;u=o.next()){var c=a(u.value,2),h=c[0],d=c[1];n[h]=d}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n}var g,m={104:"Missing Authorization Token",105:"Invalid Authorization Token",106:"Request body was not valid JSON",107:"Invalid request parameter",108:"Missing request parameter",109:"Invalid posted data",110:"Invalid Token / id",111:"Missing Token / id",112:"Content-Length header was not provided",113:"Request body too large",114:"Resource was created, updated or deleted meanwhile",115:"Method not allowed on this end point (hint: server may be readonly)",116:"Requested version not available on this server",117:"Client has sent too many requests",121:"Resource access is forbidden for this user",122:"Another resource violates constraint",201:"Service Temporary unavailable due to high load",202:"Service deprecated",999:"Internal Server Error"},_=function(e){function r(t,i){var n=e.call(this,"Timeout while trying to access "+t+" with "+JSON.stringify(i))||this;return Error.captureStackTrace&&Error.captureStackTrace(n,r),n.url=t,n.options=i,n}return t(r,e),r}(Error),b=function(e){function r(t,i,n){var o=this,s=t.status;return o=e.call(this,"Response from server unparseable (HTTP "+(s||0)+"; "+n+"): "+i)||this,Error.captureStackTrace&&Error.captureStackTrace(o,r),o.status=s,o.response=t,o.stack=n.stack,o.error=n,o}return t(r,e),r}(Error),w=function(e){function r(t,i){var n,o=this,s=t.status,a=t.statusText;i&&(a=i.error||a,i.errno&&i.errno in m?n=m[i.errno]:i.message&&(n=i.message),n&&i.message&&i.message!==n&&(n+=" ("+i.message+")"));var u="HTTP "+s+" "+a;return n&&(u+=": "+n),o=e.call(this,u.trim())||this,Error.captureStackTrace&&Error.captureStackTrace(o,r),o.response=t,o.data=i,o}return t(r,e),r}(Error),R=function(){function e(t,r){void 0===r&&(r={}),this.events=t,this.requestMode=r.requestMode||e.defaultOptions.requestMode,this.timeout=r.timeout||e.defaultOptions.timeout,this.fetchFunc=r.fetchFunc||globalThis.fetch.bind(globalThis)}return Object.defineProperty(e,"DEFAULT_REQUEST_HEADERS",{get:function(){return{Accept:"application/json","Content-Type":"application/json"}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultOptions",{get:function(){return{timeout:null,requestMode:"cors"}},enumerable:!1,configurable:!0}),e.prototype.timedFetch=function(e,t){var i=this,n=!1;return new Promise((function(o,s){var a;function u(e){return function(t){n||(a&&clearTimeout(a),e(t))}}i.timeout&&(a=setTimeout((function(){n=!0,t&&t.headers&&(t=r(r({},t),{headers:y(t.headers)})),s(new _(e,t))}),i.timeout)),i.fetchFunc(e,t).then(u(o)).catch(u(s))}))},e.prototype.processResponse=function(e){return n(this,void 0,void 0,(function(){var t,r,i,n;return o(this,(function(o){switch(o.label){case 0:return t=e.status,r=e.headers,[4,e.text()];case 1:if(0!==(i=o.sent()).length)try{n=JSON.parse(i)}catch(t){throw new b(e,i,t)}if(t>=400)throw new w(e,n);return[2,{status:t,json:n,headers:r}]}}))}))},e.prototype.retry=function(e,t,i,s){return n(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,(o=t,new Promise((function(e){return setTimeout(e,o)})))];case 1:return n.sent(),[2,this.request(e,i,r(r({},s),{retry:s.retry-1}))]}var o}))}))},e.prototype.request=function(t,i,s){return void 0===i&&(i={headers:{}}),void 0===s&&(s={retry:0}),n(this,void 0,void 0,(function(){var n,a,u;return o(this,(function(o){switch(o.label){case 0:return i.headers=r(r({},e.DEFAULT_REQUEST_HEADERS),i.headers),i.body&&i.body instanceof FormData&&(i.headers instanceof Headers?i.headers.delete("Content-Type"):Array.isArray(i.headers)||delete i.headers["Content-Type"]),i.mode=this.requestMode,[4,this.timedFetch(t,i)];case 1:return n=o.sent(),a=n.headers,this._checkForDeprecationHeader(a),this._checkForBackoffHeader(a),(u=this._checkForRetryAfterHeader(a))&&s.retry>0?[2,this.retry(t,u,i,s)]:[2,this.processResponse(n)]}}))}))},e.prototype._checkForDeprecationHeader=function(e){var t=e.get("Alert");if(t){var r;try{r=JSON.parse(t)}catch(e){return void console.warn("Unable to parse Alert header message",t)}console.warn(r.message,r.url),this.events&&this.events.emit("deprecated",r)}},e.prototype._checkForBackoffHeader=function(e){var t,r=e.get("Backoff"),i=r?parseInt(r,10):0;t=i>0?(new Date).getTime()+1e3*i:0,this.events&&this.events.emit("backoff",t)},e.prototype._checkForRetryAfterHeader=function(e){var t=e.get("Retry-After");if(t){var r=1e3*parseInt(t,10),i=(new Date).getTime()+r;return this.events&&this.events.emit("retry-after",i),r}},e}(),k={root:function(){return"/"},batch:function(){return"/batch"},permissions:function(){return"/permissions"},bucket:function(e){return"/buckets"+(e?"/"+e:"")},history:function(e){return k.bucket(e)+"/history"},collection:function(e,t){return k.bucket(e)+"/collections"+(t?"/"+t:"")},group:function(e,t){return k.bucket(e)+"/groups"+(t?"/"+t:"")},record:function(e,t,r){return k.collection(e,t)+"/records"+(r?"/"+r:"")},attachment:function(e,t,r){return k.record(e,t,r)+"/attachment"}},H={safe:!1,headers:{},patch:!1};function S(e,t){return e?t?{"If-Match":'"'+t+'"'}:{"If-None-Match":"*"}:{}}function T(e,t,i){var n=t.data,o=t.permissions;void 0===i&&(i={});var s=r(r({},H),i),a=s.headers,u=s.safe;return{method:i.method||n&&n.id?"PUT":"POST",path:e,headers:r(r({},a),S(u)),body:{data:n,permissions:o}}}function x(e,t,i){var n=t.data,o=t.permissions;void 0===i&&(i={});var s=r(r({},H),i),a=s.headers,u=s.safe,c=s.patch,h=r(r({},n),i).last_modified;return n&&0===Object.keys(n).filter((function(e){return"id"!==e&&"last_modified"!==e})).length&&(n=void 0),{method:c?"PATCH":"PUT",path:e,headers:r(r({},a),S(u,h)),body:{data:n,permissions:o}}}function E(e,t,i,n){var o,u,c,h;void 0===n&&(n={});var d=r(r({},H),n),f=d.headers,l=d.safe,p=d.last_modified,v=[];try{for(var y=s(Object.entries(t)),g=y.next();!g.done;g=y.next()){var m=a(g.value,2),_=m[0],b=m[1];if(b)try{for(var w=(c=void 0,s(b)),R=w.next();!R.done;R=w.next()){var k=R.value;v.push({op:i,path:"/permissions/"+_+"/"+k})}}catch(e){c={error:e}}finally{try{R&&!R.done&&(h=w.return)&&h.call(w)}finally{if(c)throw c.error}}}}catch(e){o={error:e}}finally{try{g&&!g.done&&(u=y.return)&&u.call(y)}finally{if(o)throw o.error}}return{method:"PATCH",path:e,headers:r(r(r({},f),S(l,p)),{"Content-Type":"application/json-patch+json"}),body:v}}function A(e,t){void 0===t&&(t={});var i=r(r({},H),t),n=i.headers,o=i.safe,s=i.last_modified;if(o&&!s)throw new Error("Safe concurrency check requires a last_modified value.");return{method:"DELETE",path:e,headers:r(r({},n),S(o,s))}}function q(e,t,i,n){var o=void 0===i?{}:i,s=o.data,a=o.permissions;void 0===n&&(n={});var u=r(r({},H),n),c=u.headers,h=u.safe,d=u.gzipped,f=r(r({},s),n).last_modified,l=function(e,t,r){void 0===r&&(r={});var i=r.filename,n=void 0===i?"untitled":i,o=p(e),s=o.blob,a=o.name,u=new FormData;for(var c in u.append("attachment",s,a||n),t)void 0!==t[c]&&u.append(c,JSON.stringify(t[c]));return u}(t,{data:s,permissions:a},n);return{method:"POST",path:e+(null!==d?"?gzipped="+(d?"true":"false"):""),headers:r(r({},c),S(h,f)),body:l}}function j(e,t){if(void 0===e&&(e=[]),void 0===t&&(t=[]),e.length!==t.length)throw new Error("Responses length should match requests one.");return e.reduce((function(e,r,i){var n=r.status,o=t[i];if(n>=200&&n<400)e.published.push(r.body);else if(404===n){var s=o.path.match(/(buckets|groups|collections|records)\/([^/]+)$/),a=s&&3===s.length?s[2]:void 0;e.skipped.push({id:a,path:o.path,error:r.body})}else 412===n?e.conflicts.push({type:"outgoing",local:o.body,remote:r.body.details&&r.body.details.existing||null}):e.errors.push({path:o.path,sent:o,error:r.body});return e}),{errors:[],published:[],conflicts:[],skipped:[]})}var P=new Uint8Array(16);function O(){if(!g&&!(g="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(P)}var C=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function I(e){return"string"==typeof e&&C.test(e)}for(var D=[],U=0;U<256;++U)D.push((U+256).toString(16).substr(1));function F(e,t,r){var i=(e=e||{}).random||(e.rng||O)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=i[n];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(D[e[t+0]]+D[e[t+1]]+D[e[t+2]]+D[e[t+3]]+"-"+D[e[t+4]]+D[e[t+5]]+"-"+D[e[t+6]]+D[e[t+7]]+"-"+D[e[t+8]]+D[e[t+9]]+"-"+D[e[t+10]]+D[e[t+11]]+D[e[t+12]]+D[e[t+13]]+D[e[t+14]]+D[e[t+15]]).toLowerCase();if(!I(r))throw TypeError("Stringified UUID is invalid");return r}(i)}var L=function(){function e(e,t,i,n){void 0===n&&(n={}),this.client=e,this.bucket=t,this.name=i,this._endpoints=e.endpoints,this._retry=n.retry||0,this._safe=!!n.safe,this._headers=r(r({},this.bucket.headers),n.headers)}return Object.defineProperty(e.prototype,"execute",{get:function(){return this.client.execute.bind(this.client)},enumerable:!1,configurable:!0}),e.prototype._getHeaders=function(e){return r(r({},this._headers),e.headers)},e.prototype._getSafe=function(e){return r({safe:this._safe},e).safe},e.prototype._getRetry=function(e){return r({retry:this._retry},e).retry},e.prototype.getTotalRecords=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t,r,i;return o(this,(function(n){switch(n.label){case 0:return t=this._endpoints.record(this.bucket.name,this.name),r={headers:this._getHeaders(e),path:t,method:"HEAD"},[4,this.client.execute(r,{raw:!0,retry:this._getRetry(e)})];case 1:return i=n.sent().headers,[2,parseInt(i.get("Total-Records"),10)]}}))}))},e.prototype.getRecordsTimestamp=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t,r;return o(this,(function(i){switch(i.label){case 0:return t=this._endpoints.record(this.bucket.name,this.name),r={headers:this._getHeaders(e),path:t,method:"HEAD"},[4,this.client.execute(r,{raw:!0,retry:this._getRetry(e)})];case 1:return[2,i.sent().headers.get("ETag")]}}))}))},e.prototype.getData=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t,r;return o(this,(function(i){switch(i.label){case 0:return t=this._endpoints.collection(this.bucket.name,this.name),r={headers:this._getHeaders(e),path:t},[4,this.client.execute(r,{retry:this._getRetry(e),query:e.query,fields:e.fields})];case 1:return[2,i.sent().data]}}))}))},e.prototype.setData=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var i,n,s,a,u;return o(this,(function(o){if(!l(e))throw new Error("A collection object is required.");return i=t.patch,n=t.permissions,s=r(r({},e),t).last_modified,a=this._endpoints.collection(this.bucket.name,this.name),u=x(a,{data:e,permissions:n},{last_modified:s,patch:i,headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(u,{retry:this._getRetry(t)})]}))}))},e.prototype.getPermissions=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t,r;return o(this,(function(i){switch(i.label){case 0:return t=this._endpoints.collection(this.bucket.name,this.name),r={headers:this._getHeaders(e),path:t},[4,this.client.execute(r,{retry:this._getRetry(e)})];case 1:return[2,i.sent().permissions]}}))}))},e.prototype.setPermissions=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i,n;return o(this,(function(o){if(!l(e))throw new Error("A permissions object is required.");return r=this._endpoints.collection(this.bucket.name,this.name),i={last_modified:t.last_modified},n=x(r,{data:i,permissions:e},{headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(n,{retry:this._getRetry(t)})]}))}))},e.prototype.addPermissions=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i,n;return o(this,(function(o){if(!l(e))throw new Error("A permissions object is required.");return r=this._endpoints.collection(this.bucket.name,this.name),i=t.last_modified,n=E(r,e,"add",{last_modified:i,headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(n,{retry:this._getRetry(t)})]}))}))},e.prototype.removePermissions=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i,n;return o(this,(function(o){if(!l(e))throw new Error("A permissions object is required.");return r=this._endpoints.collection(this.bucket.name,this.name),i=t.last_modified,n=E(r,e,"remove",{last_modified:i,headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(n,{retry:this._getRetry(t)})]}))}))},e.prototype.createRecord=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i,n;return o(this,(function(o){return r=t.permissions,i=this._endpoints.record(this.bucket.name,this.name,e.id),n=T(i,{data:e,permissions:r},{headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(n,{retry:this._getRetry(t)})]}))}))},e.prototype.addAttachment=function(e,t,i){return void 0===t&&(t={}),void 0===i&&(i={}),n(this,void 0,void 0,(function(){var n,s,a,u,c;return o(this,(function(o){switch(o.label){case 0:return n=i.permissions,s=t.id||F(),a=this._endpoints.attachment(this.bucket.name,this.name,s),u=r(r({},t),i).last_modified,c=q(a,e,{data:t,permissions:n},{last_modified:u,filename:i.filename,gzipped:i.gzipped,headers:this._getHeaders(i),safe:this._getSafe(i)}),[4,this.client.execute(c,{stringify:!1,retry:this._getRetry(i)})];case 1:return o.sent(),[2,this.getRecord(s)]}}))}))},e.prototype.removeAttachment=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i,n;return o(this,(function(o){return r=t.last_modified,i=this._endpoints.attachment(this.bucket.name,this.name,e),n=A(i,{last_modified:r,headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(n,{retry:this._getRetry(t)})]}))}))},e.prototype.updateRecord=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var i,n,s,a;return o(this,(function(o){if(!l(e))throw new Error("A record object is required.");if(!e.id)throw new Error("A record id is required.");return i=t.permissions,n=r(r({},e),t).last_modified,s=this._endpoints.record(this.bucket.name,this.name,e.id),a=x(s,{data:e,permissions:i},{headers:this._getHeaders(t),safe:this._getSafe(t),last_modified:n,patch:!!t.patch}),[2,this.client.execute(a,{retry:this._getRetry(t)})]}))}))},e.prototype.deleteRecord=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var i,n,s,a,c;return o(this,(function(o){if(!(i=u(e)).id)throw new Error("A record id is required.");return n=i.id,s=r(r({},i),t).last_modified,a=this._endpoints.record(this.bucket.name,this.name,n),c=A(a,{last_modified:s,headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(c,{retry:this._getRetry(t)})]}))}))},e.prototype.deleteRecords=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=this._endpoints.record(this.bucket.name,this.name),[2,this.client.paginatedDelete(t,e,{headers:this._getHeaders(e),retry:this._getRetry(e)})]}))}))},e.prototype.getRecord=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i;return o(this,(function(n){return r=this._endpoints.record(this.bucket.name,this.name,e),i={headers:this._getHeaders(t),path:r},[2,this.client.execute(i,{retry:this._getRetry(t),query:t.query,fields:t.fields})]}))}))},e.prototype.listRecords=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=this._endpoints.record(this.bucket.name,this.name),e.at?[2,this.getSnapshot(e.at)]:[2,this.client.paginatedList(t,e,{headers:this._getHeaders(e),retry:this._getRetry(e)})]}))}))},e.prototype.isHistoryComplete=function(){return n(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,this.bucket.listHistory({limit:1,filters:{action:"create",resource_name:"collection",collection_id:this.name}})];case 1:return e=a.apply(void 0,[t.sent().data,1]),[2,!!e[0]]}}))}))},e.prototype.getSnapshot=function(e){return n(this,void 0,void 0,(function(){var t,r,i,n,a,u,c,h,d,f,l,p,v,y,g,m,_,b,w,R;return o(this,(function(o){switch(o.label){case 0:if(!e||!Number.isInteger(e)||e<=0)throw new Error("Invalid argument, expected a positive integer.");return[4,this.isHistoryComplete()];case 1:if(!o.sent())throw new Error("Computing a snapshot is only possible when the full history for a collection is available. Here, the history plugin seems to have been enabled after the creation of the collection.");return[4,this.bucket.listHistory({pages:1/0,sort:"last_modified",filters:{resource_name:"record",collection_id:this.name}})];case 2:t=o.sent().data,r=new Map,i=new Map;try{for(n=s(t),a=n.next();!a.done;a=n.next())(y=a.value).target.data.last_modified<=e&&i.set(y.record_id,y),r.set(y.record_id,y)}catch(e){g={error:e}}finally{try{a&&!a.done&&(m=n.return)&&m.call(n)}finally{if(g)throw g.error}}return[4,this.listRecords({pages:1/0,fields:["id"]})];case 3:u=o.sent().data,c=new Set(u.map((function(e){return e.id}))),h=new Set;try{for(d=s(r.values()),f=d.next();!f.done;f=d.next())"delete"==(y=f.value).action||c.has(y.record_id)||h.add(y.record_id)}catch(e){_={error:e}}finally{try{f&&!f.done&&(b=d.return)&&b.call(d)}finally{if(_)throw _.error}}l=[];try{for(p=s(i.values()),v=p.next();!v.done;v=p.next())"delete"==(y=v.value).action||h.has(y.record_id)||l.push(y.target.data)}catch(e){w={error:e}}finally{try{v&&!v.done&&(R=p.return)&&R.call(p)}finally{if(w)throw w.error}}return[2,{last_modified:String(e),data:Array.from(l).sort((function(e,t){return t.last_modified-e.last_modified})),next:function(){throw new Error("Snapshots don't support pagination")},hasNextPage:!1,totalRecords:l.length}]}}))}))},e.prototype.batch=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){return o(this,(function(r){return[2,this.client.batch(e,{bucket:this.bucket.name,collection:this.name,headers:this._getHeaders(t),retry:this._getRetry(t),safe:this._getSafe(t),aggregate:!!t.aggregate})]}))}))},i([d(["attachments"])],e.prototype,"addAttachment",null),i([d(["attachments"])],e.prototype,"removeAttachment",null),i([d(["history"])],e.prototype,"getSnapshot",null),e}(),M=function(){function e(e,t,r){void 0===r&&(r={}),this.client=e,this.name=t,this._endpoints=e.endpoints,this._headers=r.headers||{},this._retry=r.retry||0,this._safe=!!r.safe}return Object.defineProperty(e.prototype,"execute",{get:function(){return this.client.execute.bind(this.client)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"headers",{get:function(){return this._headers},enumerable:!1,configurable:!0}),e.prototype._getHeaders=function(e){return r(r({},this._headers),e.headers)},e.prototype._getSafe=function(e){return r({safe:this._safe},e).safe},e.prototype._getRetry=function(e){return r({retry:this._retry},e).retry},e.prototype.collection=function(e,t){return void 0===t&&(t={}),new L(this.client,this,e,{headers:this._getHeaders(t),retry:this._getRetry(t),safe:this._getSafe(t)})},e.prototype.getCollectionsTimestamp=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t,r;return o(this,(function(i){switch(i.label){case 0:return t=this._endpoints.collection(this.name),r={headers:this._getHeaders(e),path:t,method:"HEAD"},[4,this.client.execute(r,{raw:!0,retry:this._getRetry(e)})];case 1:return[2,i.sent().headers.get("ETag")]}}))}))},e.prototype.getGroupsTimestamp=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t,r;return o(this,(function(i){switch(i.label){case 0:return t=this._endpoints.group(this.name),r={headers:this._getHeaders(e),path:t,method:"HEAD"},[4,this.client.execute(r,{raw:!0,retry:this._getRetry(e)})];case 1:return[2,i.sent().headers.get("ETag")]}}))}))},e.prototype.getData=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t,r;return o(this,(function(i){switch(i.label){case 0:return t=this._endpoints.bucket(this.name),r={headers:this._getHeaders(e),path:t},[4,this.client.execute(r,{retry:this._getRetry(e),query:e.query,fields:e.fields})];case 1:return[2,i.sent().data]}}))}))},e.prototype.setData=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var i,n,s,a,u,c,h;return o(this,(function(o){if(!l(e))throw new Error("A bucket object is required.");return i=r(r({},e),{id:this.name}),n=i.id,"default"===i.id&&delete i.id,s=this._endpoints.bucket(n),a=t.patch,u=t.permissions,c=r(r({},e),t).last_modified,h=x(s,{data:i,permissions:u},{last_modified:c,patch:a,headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(h,{retry:this._getRetry(t)})]}))}))},e.prototype.listHistory=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=this._endpoints.history(this.name),[2,this.client.paginatedList(t,e,{headers:this._getHeaders(e),retry:this._getRetry(e)})]}))}))},e.prototype.listCollections=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=this._endpoints.collection(this.name),[2,this.client.paginatedList(t,e,{headers:this._getHeaders(e),retry:this._getRetry(e)})]}))}))},e.prototype.createCollection=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i,n,s,a;return o(this,(function(o){return r=t.permissions,i=t.data,(n=void 0===i?{}:i).id=e,s=this._endpoints.collection(this.name,e),a=T(s,{data:n,permissions:r},{headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(a,{retry:this._getRetry(t)})]}))}))},e.prototype.deleteCollection=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var i,n,s,a,c;return o(this,(function(o){if(!(i=u(e)).id)throw new Error("A collection id is required.");return n=i.id,s=r(r({},i),t).last_modified,a=this._endpoints.collection(this.name,n),c=A(a,{last_modified:s,headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(c,{retry:this._getRetry(t)})]}))}))},e.prototype.deleteCollections=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=this._endpoints.collection(this.name),[2,this.client.paginatedDelete(t,e,{headers:this._getHeaders(e),retry:this._getRetry(e)})]}))}))},e.prototype.listGroups=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=this._endpoints.group(this.name),[2,this.client.paginatedList(t,e,{headers:this._getHeaders(e),retry:this._getRetry(e)})]}))}))},e.prototype.getGroup=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i;return o(this,(function(n){return r=this._endpoints.group(this.name,e),i={headers:this._getHeaders(t),path:r},[2,this.client.execute(i,{retry:this._getRetry(t),query:t.query,fields:t.fields})]}))}))},e.prototype.createGroup=function(e,t,i){return void 0===t&&(t=[]),void 0===i&&(i={}),n(this,void 0,void 0,(function(){var n,s,a,u;return o(this,(function(o){return n=r(r({},i.data),{id:e,members:t}),s=this._endpoints.group(this.name,e),a=i.permissions,u=T(s,{data:n,permissions:a},{headers:this._getHeaders(i),safe:this._getSafe(i)}),[2,this.client.execute(u,{retry:this._getRetry(i)})]}))}))},e.prototype.updateGroup=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var i,n,s,a,u,c;return o(this,(function(o){if(!l(e))throw new Error("A group object is required.");if(!e.id)throw new Error("A group id is required.");return i=r(r({},t.data),e),n=this._endpoints.group(this.name,e.id),s=t.patch,a=t.permissions,u=r(r({},i),t).last_modified,c=x(n,{data:i,permissions:a},{last_modified:u,patch:s,headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(c,{retry:this._getRetry(t)})]}))}))},e.prototype.deleteGroup=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var i,n,s,a,c;return o(this,(function(o){return i=u(e),n=i.id,s=r(r({},i),t).last_modified,a=this._endpoints.group(this.name,n),c=A(a,{last_modified:s,headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(c,{retry:this._getRetry(t)})]}))}))},e.prototype.deleteGroups=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=this._endpoints.group(this.name),[2,this.client.paginatedDelete(t,e,{headers:this._getHeaders(e),retry:this._getRetry(e)})]}))}))},e.prototype.getPermissions=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return t={headers:this._getHeaders(e),path:this._endpoints.bucket(this.name)},[4,this.client.execute(t,{retry:this._getRetry(e)})];case 1:return[2,r.sent().permissions]}}))}))},e.prototype.setPermissions=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i,n;return o(this,(function(o){if(!l(e))throw new Error("A permissions object is required.");return r=this._endpoints.bucket(this.name),i=t.last_modified,n=x(r,{data:{last_modified:i},permissions:e},{headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(n,{retry:this._getRetry(t)})]}))}))},e.prototype.addPermissions=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i,n;return o(this,(function(o){if(!l(e))throw new Error("A permissions object is required.");return r=this._endpoints.bucket(this.name),i=t.last_modified,n=E(r,e,"add",{last_modified:i,headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(n,{retry:this._getRetry(t)})]}))}))},e.prototype.removePermissions=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i,n;return o(this,(function(o){if(!l(e))throw new Error("A permissions object is required.");return r=this._endpoints.bucket(this.name),i=t.last_modified,n=E(r,e,"remove",{last_modified:i,headers:this._getHeaders(t),safe:this._getSafe(t)}),[2,this.client.execute(n,{retry:this._getRetry(t)})]}))}))},e.prototype.batch=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){return o(this,(function(r){return[2,this.client.batch(e,{bucket:this.name,headers:this._getHeaders(t),retry:this._getRetry(t),safe:this._getSafe(t),aggregate:!!t.aggregate})]}))}))},i([d(["history"])],e.prototype,"listHistory",null),e}();return function(e){function r(t,r){void 0===r&&(r={});var i=r.events;return e.call(this,t,Object.assign({events:i},r))||this}return t(r,e),r}(function(){function e(e,t){if("string"!=typeof e||!e.length)throw new Error("Invalid remote URL: "+e);"/"===e[e.length-1]&&(e=e.slice(0,-1)),this._backoffReleaseTime=null,this._requests=[],this._isBatch=!!t.batch,this._retry=t.retry||0,this._safe=!!t.safe,this._headers=t.headers||{},this.remote=e,this.serverInfo=null,this.events=t.events,this.endpoints=k;var r=t.fetchFunc,i=t.requestMode,n=t.timeout;this.http=new R(this.events,{fetchFunc:r,requestMode:i,timeout:n}),this._registerHTTPEvents()}var t,l;return Object.defineProperty(e.prototype,"remote",{get:function(){return this._remote},set:function(e){var t;try{t=e.match(/\/(v\d+)\/?$/)[1]}catch(t){throw new Error("The remote URL must contain the version: "+e)}if("v1"!==t)throw new Error("Unsupported protocol version: "+t);this._remote=e,this._version=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backoff",{get:function(){var e=(new Date).getTime();return this._backoffReleaseTime&&e<this._backoffReleaseTime?this._backoffReleaseTime-e:0},enumerable:!1,configurable:!0}),e.prototype._registerHTTPEvents=function(){var e=this;!this._isBatch&&this.events&&this.events.on("backoff",(function(t){e._backoffReleaseTime=t}))},e.prototype.bucket=function(e,t){return void 0===t&&(t={}),new M(this,e,{headers:this._getHeaders(t),safe:this._getSafe(t),retry:this._getRetry(t)})},e.prototype.setHeaders=function(e){this._headers=r(r({},this._headers),e),this.serverInfo=null},e.prototype._getHeaders=function(e){return r(r({},this._headers),e.headers)},e.prototype._getSafe=function(e){return r({safe:this._safe},e).safe},e.prototype._getRetry=function(e){return r({retry:this._retry},e).retry},e.prototype._getHello=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return t=this.remote+k.root(),[4,this.http.request(t,{headers:this._getHeaders(e)},{retry:this._getRetry(e)})];case 1:return[2,r.sent().json]}}))}))},e.prototype.fetchServerInfo=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return this.serverInfo?[2,this.serverInfo]:(t=this,[4,this._getHello({retry:this._getRetry(e)})]);case 1:return t.serverInfo=r.sent(),[2,this.serverInfo]}}))}))},e.prototype.fetchServerSettings=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.fetchServerInfo(e)];case 1:return[2,t.sent().settings]}}))}))},e.prototype.fetchServerCapabilities=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.fetchServerInfo(e)];case 1:return[2,t.sent().capabilities]}}))}))},e.prototype.fetchUser=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this._getHello(e)];case 1:return[2,t.sent().user]}}))}))},e.prototype.fetchHTTPApiVersion=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.fetchServerInfo(e)];case 1:return[2,t.sent().http_api_version]}}))}))},e.prototype._batchRequests=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var r,i,n,u,c,h,d,f,l,p,v,y;return o(this,(function(o){switch(o.label){case 0:return r=this._getHeaders(t),e.length?[4,this.fetchServerSettings({retry:this._getRetry(t)})]:[2,[]];case 1:if(i=o.sent(),!((n=i.batch_max_requests)&&e.length>n))return[3,10];g=e,u=(m=n)<=0?[g]:g.reduce((function(e,t,r){return 0===r||r%m==0?e.push([t]):e[e.length-1].push(t),e}),[]),c=[],o.label=2;case 2:o.trys.push([2,7,8,9]),h=s(u),d=h.next(),o.label=3;case 3:return d.done?[3,6]:(f=d.value,[4,this._batchRequests(f,t)]);case 4:l=o.sent(),c.push.apply(c,function(e,t,r){if(r||2===arguments.length)for(var i,n=0,o=t.length;n<o;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||t)}([],a(l))),o.label=5;case 5:return d=h.next(),[3,3];case 6:return[3,9];case 7:return p=o.sent(),v={error:p},[3,9];case 8:try{d&&!d.done&&(y=h.return)&&y.call(h)}finally{if(v)throw v.error}return[7];case 9:return[2,c];case 10:return[4,this.execute({headers:r,path:k.batch(),method:"POST",body:{defaults:{headers:r},requests:e}},{retry:this._getRetry(t)})];case 11:return[2,o.sent().responses]}var g,m}))}))},e.prototype.batch=function(t,r){return void 0===r&&(r={}),n(this,void 0,void 0,(function(){var i,n;return o(this,(function(o){switch(o.label){case 0:return i=new e(this.remote,{events:this.events,batch:!0,safe:this._getSafe(r),retry:this._getRetry(r)}),r.bucket&&r.collection?t(i.bucket(r.bucket).collection(r.collection)):r.bucket?t(i.bucket(r.bucket)):t(i),[4,this._batchRequests(i._requests,r)];case 1:return n=o.sent(),r.aggregate?[2,j(n,i._requests)]:[2,n]}}))}))},e.prototype.execute=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var i,n,s,a,u,h,d;return o(this,(function(o){switch(o.label){case 0:return i=t.raw,n=void 0!==i&&i,s=t.stringify,a=void 0===s||s,this._isBatch?(this._requests.push(e),u="This result is generated from within a batch operation and should not be consumed.",[2,n?{status:0,json:u,headers:new Headers}:u]):(h=this.remote+function(e,t){void 0===t&&(t={});var i=r({},t.query);t.fields&&(i._fields=t.fields);var n=c(i);return n?e+"?"+n:e}(e.path,t),[4,this.http.request(h,v({method:e.method,headers:e.headers,body:a?JSON.stringify(e.body):e.body}),{retry:this._getRetry(t)})]);case 1:return d=o.sent(),[2,n?d:d.json]}}))}))},e.prototype.paginatedOperation=function(e,t,i){return void 0===t&&(t={}),void 0===i&&(i={}),n(this,void 0,void 0,(function(){var s,a,u,h,d,f,l,p,v,y,g,m,_,b,w,R,k=this;return o(this,(function(H){switch(H.label){case 0:if(s=r({sort:"-last_modified"},t),a=s.sort,u=s.filters,h=s.limit,d=s.pages,f=s.since,l=s.fields,f&&"string"!=typeof f)throw new Error("Invalid value for since ("+f+"), should be ETag value.");return p=r(r({},u),{_sort:a,_limit:h,_since:f}),l&&(p._fields=l),v=c(p),y=[],g=0,m=function(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){if(!e)throw new Error("Pagination exhausted.");return[2,_(e)]}))}))},_=function(e){return n(k,void 0,void 0,(function(){var t,r;return o(this,(function(n){switch(n.label){case 0:return t=i.headers,r=w,[4,this.http.request(e,{headers:t})];case 1:return[2,r.apply(void 0,[n.sent()])]}}))}))},b=function(e,t,r){return{last_modified:r?r.replace(/"/g,""):r,data:e,next:m.bind(null,t),hasNextPage:!!t,totalRecords:-1}},R=w=function(e){var t=e.headers,r=void 0===t?new Headers:t,i=e.json,s=void 0===i?{}:i;return n(this,void 0,void 0,(function(){var e,t;return o(this,(function(i){return e=r.get("Next-Page"),t=r.get("ETag"),d?(y=y.concat(s.data),(g+=1)>=d||!e?[2,b(y,e,t)]:[2,_(e)]):[2,b(s.data,e,t)]}))}))},[4,this.execute({headers:i.headers?i.headers:{},path:e+"?"+v,method:i.method},{raw:!0,retry:i.retry||0})];case 1:return[2,R.apply(void 0,[H.sent()])]}}))}))},e.prototype.paginatedList=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),n(this,void 0,void 0,(function(){return o(this,(function(i){return[2,this.paginatedOperation(e,t,r)]}))}))},e.prototype.paginatedDelete=function(e,t,i){void 0===t&&(t={}),void 0===i&&(i={});var n=i.headers,o=i.safe,s=A(e,{headers:n,safe:o||!1,last_modified:i.last_modified});return this.paginatedOperation(e,t,r(r({},i),{headers:s.headers,method:"DELETE"}))},e.prototype.listPermissions=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t,i;return o(this,(function(n){return t=k.permissions(),i=r({sort:"id"},e),[2,this.paginatedList(t,i,{headers:this._getHeaders(e),retry:this._getRetry(e)})]}))}))},e.prototype.listBuckets=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=k.bucket(),[2,this.paginatedList(t,e,{headers:this._getHeaders(e),retry:this._getRetry(e)})]}))}))},e.prototype.createBucket=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var i,n,s,a;return o(this,(function(o){return i=t.data,n=t.permissions,s=r(r({},i),{id:e||void 0}),a=s.id?k.bucket(s.id):k.bucket(),[2,this.execute(T(a,{data:s,permissions:n},{headers:this._getHeaders(t),safe:this._getSafe(t)}),{retry:this._getRetry(t)})]}))}))},e.prototype.deleteBucket=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,(function(){var i,n,s;return o(this,(function(o){if(!(i=u(e)).id)throw new Error("A bucket id is required.");return n=k.bucket(i.id),s=r(r({},i),t).last_modified,[2,this.execute(A(n,{last_modified:s,headers:this._getHeaders(t),safe:this._getSafe(t)}),{retry:this._getRetry(t)})]}))}))},e.prototype.deleteBuckets=function(e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=k.bucket(),[2,this.paginatedDelete(t,e,{headers:this._getHeaders(e),retry:this._getRetry(e),safe:e.safe,last_modified:e.last_modified})]}))}))},e.prototype.createAccount=function(e,t){return n(this,void 0,void 0,(function(){return o(this,(function(r){return[2,this.execute(T("/accounts/"+e,{data:{password:t}},{method:"PUT"}))]}))}))},i([f("This operation is not supported within a batch operation.")],e.prototype,"fetchServerSettings",null),i([f("This operation is not supported within a batch operation.")],e.prototype,"fetchServerCapabilities",null),i([f("This operation is not supported within a batch operation.")],e.prototype,"fetchUser",null),i([f("This operation is not supported within a batch operation.")],e.prototype,"fetchHTTPApiVersion",null),i([f("Can't use batch within a batch!")],e.prototype,"batch",null),i([d(["permissions_endpoint"])],e.prototype,"listPermissions",null),i([(t="1.4",l="2.0",function(e,r,i){var n=i.value;return{configurable:!0,get:function(){var e=this,i=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=e.client?e.client:e;return o.fetchHTTPApiVersion().then((function(e){return h(e,t,l)})).then((function(){return n.apply(e,r)}))};return Object.defineProperty(this,r,{value:i,configurable:!0,writable:!0}),i}}})],e.prototype,"deleteBuckets",null),i([d(["accounts"])],e.prototype,"createAccount",null),e}())}));
//# sourceMappingURL=kinto-http.min.js.map
